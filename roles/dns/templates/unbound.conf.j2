# {{ansible_managed}}
server:
  interface: 0.0.0.0
  interface: ::0

  module-config: "validator iterator"

  chroot: ""
  pidfile: "/var/run/unbound/unbound.pid"

  # Tuning for performance
  num-threads: 4
  so-reuseport: yes
  msg-cache-size: 1024m
  rrset-cache-size: 2048m
  msg-cache-slabs: 4
  rrset-cache-slabs: 4
  infra-cache-slabs: 4
  key-cache-slabs: 4
  outgoing-range: 8192
  num-queries-per-thread: 4096
  prefetch: yes
  prefetch-key: yes
  rrset-roundrobin: yes

  # Privacy and hardening
  qname-minimisation: yes
  harden-glue: yes
  harden-dnssec-stripped: yes
  harden-below-nxdomain: yes
  harden-algo-downgrade: yes
  harden-short-bufsize: yes
  harden-large-queries: yes
  harden-referral-path: yes
  aggressive-nsec: yes
  hide-identity: yes
  hide-version: yes
  hide-trustanchor: yes
  hide-http-user-agent: yes
  hide-http-user-agent: yes
  minimal-responses: yes
  deny-any: yes
  trust-anchor-signaling: yes
  root-key-sentinel: yes
  val-clean-additional: yes
  val-permissive-mode: no

  # Access control
  access-control: 192.168.0.0/16 allow
  access-control: 0.0.0.0/0 refuse

  # Enable DNSSEC trust anchor maintenance
  auto-trust-anchor-file: "/var/lib/unbound/root.key"

  # Reasonable EDNS size to reduce fragmentation
  edns-buffer-size: 1232
  max-udp-size: 1232

{% if lancache.enabled | default(false) %}
  # Include extra LANcache overrides
  include: "/etc/unbound/lancache.d/*.conf"
{% endif %}
# Forward all queries to upstream resolvers
forward-zone:
  name: "."
{% for ip in upstreams %}
  forward-addr: {{ ip }}
{% endfor %}
