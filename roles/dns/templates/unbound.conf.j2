# {{ansible_managed}}
server:
  # Listen only on localhost (tightens exposure)
  interface: 0.0.0.0
  interface: ::0

  # Tuning for performance
  num-threads: 4
  so-reuseport: yes
  msg-cache-size: 1024m
  rrset-cache-size: 2048m
  msg-cache-slabs: 4
  rrset-cache-slabs: 4
  infra-cache-slabs: 4
  key-cache-slabs: 4
  outgoing-range: 8192
  num-queries-per-thread: 4096
  prefetch: yes
  prefetch-key: yes

  # Allow only local queries
  access-control: 127.0.0.0/8 allow
  access-control: ::1 allow

  # Privacy and hardening
  qname-minimisation: yes
  harden-glue: yes
  harden-dnssec-stripped: yes
  harden-below-nxdomain: yes
  harden-algo-downgrade: yes
  aggressive-nsec: yes
  hide-identity: yes
  hide-version: yes
  minimal-responses: yes
  deny-any: yes

  access-control: 192.168.0.0/16 allow
  access-control: 0.0.0.0/0 refuse

  # Enable DNSSEC trust anchor maintenance
  auto-trust-anchor-file: "/var/lib/unbound/root.key"

  # Reasonable EDNS size to reduce fragmentation
  edns-buffer-size: 1232
  max-udp-size: 1232

{% if lancache.enabled | default(false) %}
  # Include extra LANcache overrides
  include: "/etc/unbound/lancache.d/*.conf"
{% endif %}
# Forward all queries to upstream resolvers
forward-zone:
  name: "."
{% for ip in upstreams %}
  forward-addr: {{ ip }}
{% endfor %}
