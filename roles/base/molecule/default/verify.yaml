---
- name: Verify
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Verify SSH configuration - Root login disabled
      lineinfile:
        path: /etc/ssh/sshd_config
        line: 'PermitRootLogin no'
        state: present
      check_mode: true
      register: ssh_root_config
      failed_when: ssh_root_config is changed

    - name: Verify SSH configuration - X11 forwarding disabled
      lineinfile:
        path: /etc/ssh/sshd_config
        line: 'X11Forwarding no'
        state: present
      check_mode: true
      register: ssh_x11_config
      failed_when: ssh_x11_config is changed

    - name: Verify SSH configuration - IPv4 only
      lineinfile:
        path: /etc/ssh/sshd_config
        line: 'AddressFamily inet'
        state: present
      check_mode: true
      register: ssh_ipv4_config
      failed_when: ssh_ipv4_config is changed

    - name: Verify SSH service is running
      service:
        name: sshd
        state: started
      check_mode: true
      register: sshd_service
      failed_when: sshd_service is changed

    - name: Verify firewalld is installed and running
      service:
        name: firewalld
        state: started
        enabled: true
      check_mode: true
      register: firewalld_service
      failed_when: firewalld_service is changed

    - name: Verify SSH is allowed in firewalld
      command: firewall-cmd --list-services
      register: firewall_services
      failed_when: "'ssh' not in firewall_services.stdout"

    - name: Verify timesyncd configuration exists
      stat:
        path: /etc/systemd/timesyncd.conf
      register: timesyncd_config
      failed_when: not timesyncd_config.stat.exists

    - name: Verify timezone is set correctly
      command: timedatectl show --property=Timezone --value
      register: current_timezone
      failed_when: current_timezone.stdout != 'UTC'

    - name: Verify timesyncd is enabled and running
      service:
        name: systemd-timesyncd
        state: started
        enabled: true
      check_mode: true
      register: timesyncd_service
      failed_when: timesyncd_service is changed
...
